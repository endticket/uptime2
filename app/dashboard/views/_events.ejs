      <div class="portlet-body flip-scroll" id="checkEvents">
      </div>

<script id="event_template" type="text/template">
<tr>
            <td><span class="label bg-default bg-font-default" title="{{= date }}">{{= date.format('LT') }}</span></td>
            <td>
              {{ var label = (event.message == 'paused' || event.message == 'restarted') ? 'bg-blue bg-font-blue' : (event.message == 'up') ? 'bg-green-jungle bg-font-green-jungle' : 'bg-red-mint bg-font-red-mint' }}
              <span class="label {{= label }}">{{= event.message }}</span>
            </td>
            <td>
              <a href="{{=  '/dashboard/checks/' + event.check._id }}">{{= event.check.name }}</a>
              <a href="{{= event.check.url }}" target="_blank"><img src="/dashboard/images/external-link-ltr-icon.png"></a>
  {{ switch (event.message) { // cannot close ejs tag here or compilation fails, sorry
       case 'paused': }}
    {{ case 'restarted': }}
      was {{= event.message }}
    {{ break; }}
    {{ case 'down': }}
      went down ({{= event.details }})
    {{ break; }}
    {{ case 'up': }}
      {{ if (event.downtime) { }}
      went back up after {{= moment.duration(event.downtime).humanize() }} of downtime
      {{ } else { }}
      is now up
      {{ } }}
    {{ break; }}
    {{ default: }}
      unnown event
  {{ } }}
            </td>
</tr>
</script>
<script>
$(document).ready(function() {
  var highlightFrom = window.location.search.substring(0,15) == "?highlightFrom=" ? parseInt(window.location.search.substring(15)) : Date.now();
  var event_template = document.getElementById('event_template').innerHTML;
  var ejs = require('ejs');
  ejs.open = '{{';
  ejs.close = '}}';
  var adjustHash = function() {
   var hash = window.location.hash;
    if (hash) {
      $(hash).get(0).scrollIntoView();
    }
  };
  var emptyEvents = function() {
    $('#checkEvents').html('<p>Nothing happened lately. All Green!</p>');
    adjustHash();
  }
  var updateEvents = function() {
    var queryString = typeof dateInterval == 'undefined' ? '' : dateInterval.getIntervalQueryString();
    $.getJSON('<%= url %>' + queryString, function(events) {
      if ($.isEmptyObject(events)) {
        emptyEvents();
        return;
      }
      var lines = [];
      var nbEvents = 0;
      $.each(events, function(key, eventGroup) {
        lines.push('<h3>' + moment(key).format('dddd, MMMM Do') + '</h3>');
        lines.push(`<table class="table table-bordered table-striped table-condensed flip-content">
          <thead class="flip-content">
            <tr>
              <th width="10%">Time</th>
              <th>Status</th>
              <th>URL</th>
            </tr>
          </thead>
          <tbody>`);
        $.each(eventGroup, function(key, event) {
          if (!event.message) return;
          lines.push(ejs.render(event_template, { event: event, date: moment(event.timestamp), highlightFrom: highlightFrom, route: '/dashboard/' }));
          nbEvents++;
        });
        lines.push(`</tbody></table>`);
      });
      if (nbEvents == 100) {
        lines.push('<p>List limited to first 100 events - dig down to see all events</p>')
      }
      $('#checkEvents').html(lines.join(''));
      adjustHash();
    });
  }
  socket.on('CheckEvent', updateEvents);
  if(typeof dateInterval != 'undefined') {
    dateInterval.on('refresh-stats', function() {
      if (!this.stat) return emptyEvents();
      var downtime = 0;
      $.each(this.stats, function(stat) {
        downtime += stat.downtime;
      });
      if (downtime == 0) return emptyEvents();
      updateEvents();
    });
  } else {
    updateEvents();
  }
});
</script>
